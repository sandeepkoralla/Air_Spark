<!DOCTYPE html>
<html>
<head>
  <meta name="databricks-html-version" content="1">
<title>Spark / Monte Carlo Simulation - Databricks</title>

<meta charset="utf-8">
<meta name="google" content="notranslate">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Type" content="text/html; charset=UTF8">
<link rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700">

<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/lib/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/lib/jquery-ui-bundle/jquery-ui.min.css">
<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/css/main.css">
<link rel="stylesheet" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/css/print.css" media="print">
<link rel="icon" type="image/png" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/img/favicon.ico"/>
<script>window.settings = {"sparkDocsSearchGoogleCx":"004588677886978090460:_rj0wilqwdm","dbcForumURL":"http://forums.databricks.com/","dbfsS3Host":"https://databricks-prod-storage-oregon.s3.amazonaws.com","enableThirdPartyApplicationsUI":false,"enableClusterAcls":true,"notebookRevisionVisibilityHorizon":0,"enableTableHandler":true,"isAdmin":false,"enablePresentationTimerConfig":true,"enableFullTextSearch":true,"enableElasticSparkUI":true,"clusters":false,"hideOffHeapCache":false,"applications":false,"useStaticGuide":false,"fileStoreBase":"FileStore","configurableSparkOptionsSpec":[{"keyPattern":"spark\\.kryo(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.kryo.*","valuePatternDisplay":"*","description":"Configuration options for Kryo serialization"},{"keyPattern":"spark\\.io\\.compression\\.codec","valuePattern":"(lzf|snappy|org\\.apache\\.spark\\.io\\.LZFCompressionCodec|org\\.apache\\.spark\\.io\\.SnappyCompressionCodec)","keyPatternDisplay":"spark.io.compression.codec","valuePatternDisplay":"snappy|lzf","description":"The codec used to compress internal data such as RDD partitions, broadcast variables and shuffle outputs."},{"keyPattern":"spark\\.serializer","valuePattern":"(org\\.apache\\.spark\\.serializer\\.JavaSerializer|org\\.apache\\.spark\\.serializer\\.KryoSerializer)","keyPatternDisplay":"spark.serializer","valuePatternDisplay":"org.apache.spark.serializer.JavaSerializer|org.apache.spark.serializer.KryoSerializer","description":"Class to use for serializing objects that will be sent over the network or need to be cached in serialized form."},{"keyPattern":"spark\\.rdd\\.compress","valuePattern":"(true|false)","keyPatternDisplay":"spark.rdd.compress","valuePatternDisplay":"true|false","description":"Whether to compress serialized RDD partitions (e.g. for StorageLevel.MEMORY_ONLY_SER). Can save substantial space at the cost of some extra CPU time."},{"keyPattern":"spark\\.speculation","valuePattern":"(true|false)","keyPatternDisplay":"spark.speculation","valuePatternDisplay":"true|false","description":"Whether to use speculation (recommended off for streaming)"},{"keyPattern":"spark\\.es(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"es(\\.([^\\.]+))+","valuePattern":".*","keyPatternDisplay":"es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"spark\\.(storage|shuffle)\\.memoryFraction","valuePattern":"0?\\.0*([1-9])([0-9])*","keyPatternDisplay":"spark.(storage|shuffle).memoryFraction","valuePatternDisplay":"(0.0,1.0)","description":"Fraction of Java heap to use for Spark's shuffle or storage"},{"keyPattern":"spark\\.streaming\\.backpressure\\.enabled","valuePattern":"(true|false)","keyPatternDisplay":"spark.streaming.backpressure.enabled","valuePatternDisplay":"true|false","description":"Enables or disables Spark Streaming's internal backpressure mechanism (since 1.5). This enables the Spark Streaming to control the receiving rate based on the current batch scheduling delays and processing times so that the system receives only as fast as the system can process. Internally, this dynamically sets the maximum receiving rate of receivers. This rate is upper bounded by the values `spark.streaming.receiver.maxRate` and `spark.streaming.kafka.maxRatePerPartition` if they are set."},{"keyPattern":"spark\\.streaming\\.receiver\\.maxRate","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.receiver.maxRate","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which each receiver will receive data. Effectively, each stream will consume at most this number of records per second. Setting this configuration to 0 or a negative number will put no limit on the rate. See the deployment guide in the Spark Streaming programing guide for mode details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRatePerPartition","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRatePerPartition","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which data will be read from each Kafka partition when using the Kafka direct stream API introduced in Spark 1.3. See the Kafka Integration guide for more details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRetries","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRetries","valuePatternDisplay":"numeric","description":"Maximum number of consecutive retries the driver will make in order to find the latest offsets on the leader of each partition (a default value of 1 means that the driver will make a maximum of 2 attempts). Only applies to the Kafka direct stream API introduced in Spark 1.3."},{"keyPattern":"spark\\.streaming\\.ui\\.retainedBatches","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.ui.retainedBatches","valuePatternDisplay":"numeric","description":"How many batches the Spark Streaming UI and status APIs remember before garbage collecting."}],"enableReactNotebookComments":true,"enableResetPassword":true,"sparkVersions":[{"key":"1.3.x","displayName":"Spark 1.3.0","packageLabel":"spark-1.3-jenkins-ip-10-2-0-138-U094163cf51-S47b89c350f-2015-12-03-00:16:18.916275","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.4.x","displayName":"Spark 1.4.1","packageLabel":"spark-1.4-jenkins-ip-10-2-0-138-U094163cf51-S2f95f6c227-2015-12-03-00:16:18.916275","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.5.x","displayName":"Spark 1.5.2","packageLabel":"spark-1.5-jenkins-ip-10-2-0-138-U094163cf51-S336f76a5be-2015-12-03-00:16:18.916275","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.x","displayName":"Spark 1.6 Branch Preview","packageLabel":"spark-1.6-jenkins-ip-10-2-0-138-U094163cf51-S3436f2ea50-2015-12-03-00:16:18.916275","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"master","displayName":"Spark master (dev)","packageLabel":"","upgradable":true,"deprecated":false,"customerVisible":false}],"enableRestrictedClusterCreation":false,"enableFeedback":false,"defaultNumWorkers":8,"serverContinuationTimeoutMillis":10000,"driverStderrFilePrefix":"stderr","driverStdoutFilePrefix":"stdout","enableSparkDocsSearch":true,"sparkHistoryServerEnabled":true,"sanitizeMarkdownHtml":true,"enableIPythonImportExport":true,"enableNotebookHistoryDiffing":true,"branch":"2.8.1","local":false,"displayDefaultContainerMemoryGB":6,"deploymentMode":"production","useSpotForWorkers":false,"enableStaticNotebooks":true,"dbcGuideURL":"#workspace/databricks_guide/00 Welcome to Databricks","enableClusterAclsConfig":false,"orgId":0,"enableNotebookGitVersioning":true,"files":"files/","enableDriverLogsUI":true,"disableLegacyDashboards":false,"enableWorkspaceAclsConfig":true,"dropzoneMaxFileSize":4096,"enableNewDashboardViews":false,"driverLog4jFilePrefix":"log4j","enableMavenLibraries":true,"defaultSparkVersion":{"key":"1.5.x","displayName":"Spark 1.5.2","packageLabel":"spark-1.5-jenkins-ip-10-2-0-138-U094163cf51-S336f76a5be-2015-12-03-00:16:18.916275","upgradable":true,"deprecated":false,"customerVisible":true},"clusterPublisherRootId":5,"enableLatestJobRunResultPermalink":true,"enableSparkConfUI":true,"enableJdbcImport":true,"logfiles":"logfiles/","enableClusterDeltaUpdates":true,"csrfToken":"d3dde7ae-fd45-4989-86b8-e91415a5ebcf","useFixedStaticNotebookVersionForDevelopment":false,"enableBasicReactDialogBoxes":true,"requireEmailUserName":true,"enableDashboardViews":false,"dbcFeedbackURL":"http://feedback.databricks.com/forums/263785-product-feedback","enableWorkspaceAclService":true,"enableWorkspaceAcls":true,"gitHash":"094163cf51fcd4717c3ea96799d1008723ae8985","userFullname":"Suresh Jayaram","enableImportFromUrl":true,"enableMiniClusters":false,"enableWebSocketDeltaUpdates":true,"enableDebugUI":false,"showHiddenSparkVersions":false,"allowNonAdminUsers":true,"userId":100017,"dbcSupportURL":"","staticNotebookResourceUrl":"https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/","enableSparkPackages":true,"enableNotebookHistoryUI":true,"enableFolderHtmlExport":true,"enableSparkVersionsUI":true,"databricksGuideStaticUrl":"","notebookLoadingBackground":"#fff","enableNewJobRunDetailsPage":true,"enableDashboardExport":true,"user":"surjayaram@paypal.com","enableServerAutoComplete":true,"enableStaticHtmlImport":true,"defaultMemoryPerContainerMB":6000,"enablePresenceUI":true,"tablesPublisherRootId":7,"accounts":false,"enableNewProgressReportUI":true,"defaultCoresPerContainer":4};</script>
<script>var __DATABRICKS_NOTEBOOK_MODEL = {"version":"NotebookV1","origId":3928,"name":"Spark / Monte Carlo Simulation","language":"python","commands":[{"version":"CommandV1","origId":3929,"guid":"97e13470-e8b7-474d-b199-122281f55a2b","subtype":"command","commandType":"auto","position":1.0,"command":"%md #Monte Carlo Simulation (Python)\nExample of how to use Monte Carlo simulatations in Databricks to model the frequency of dice rolls.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","iPythonMetadata":null,"nuid":"ec23d313-023c-421a-96d6-4c583e43e3e0"},{"version":"CommandV1","origId":3930,"guid":"95579429-ab70-4470-ad5a-b69000edc39e","subtype":"command","commandType":"auto","position":2.0,"command":"%md We are trying to prove that with two dice the probability of rolling a 7 has the highest probability and rolling a 12 or snake eyes (2) has the lowest probability.\n\nThe probability table for rolling two dice is as follows:\n\n| Roll   |      Combinations      |  Probability |\n|----------|:-------------:|------:|\n| 2 |  1 | 2.78% |\n| 3 |  2   |   5.56% |\n| 4 |  3 |    8.33% |\n|5|4|11.11%|\n|6|5|13.89%|\n|7|6|16.67%|\n|8|5|13.89%|\n|9|4|11.11%|\n|10|3|8.33%|\n|11|2|5.56%|\n|12|1|2.78%|\n|Total|36|100.%|\n\nSource: http://boardgames.about.com/od/dicegames/a/probabilities.htm\n\nCan we use Spark to simulate dice rolls to prove that these probabilities hold true?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","iPythonMetadata":null,"nuid":"80371aef-ec48-4faf-956c-4097868a705a"},{"version":"CommandV1","origId":3931,"guid":"25697368-c341-482f-b4b5-c9783f33e481","subtype":"command","commandType":"auto","position":2.5,"command":"%md Import Standard Python Random Uniform number generator and math functions","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","iPythonMetadata":null,"nuid":"6e622288-69d3-4f70-86d4-badce0fbecdc"},{"version":"CommandV1","origId":3932,"guid":"601b9024-a25b-42ad-a52c-6d492520f4c3","subtype":"command","commandType":"auto","position":3.0,"command":"from numpy.random import uniform\nfrom math import ceil\nfrom operator import add","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"plotOptions":null},"errorSummary":null,"error":null,"startTime":1.440449537141E12,"submitTime":1.440449537069E12,"finishTime":1.440449537286E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"a84b356d-336d-4a6d-a3a7-b2f898f28144"},{"version":"CommandV1","origId":3933,"guid":"b7425ff6-36a0-4620-bb33-2460661a36f9","subtype":"command","commandType":"auto","position":3.5,"command":"%md ##Step 1: Define a Row Type \n* RollValue: the actual roll that occurred between 2 and 12\n* RollCount: number of times this roll occured ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","iPythonMetadata":null,"nuid":"7e8456d1-ee65-499f-a437-0ba3eddbb02d"},{"version":"CommandV1","origId":3934,"guid":"30fc540c-0948-4b68-93af-63b03df9bbec","subtype":"command","commandType":"auto","position":4.0,"command":"from pyspark.sql import Row\nDiceRoll = Row('RollValue', 'RollCount')","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"plotOptions":null},"errorSummary":null,"error":null,"startTime":1.440449545969E12,"submitTime":1.440449545909E12,"finishTime":1.44044954601E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"f4437c64-06a3-4ca4-83e7-c9d54f0df7d1"},{"version":"CommandV1","origId":3935,"guid":"ff6d11e8-e374-49ab-a1dd-b9005ad0a560","subtype":"command","commandType":"auto","position":4.5,"command":"%md ##Step 2: Create a Function that Simulates a Dice Roll","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","iPythonMetadata":null,"nuid":"110f0428-bf93-4916-8355-adf43139a7b0"},{"version":"CommandV1","origId":3936,"guid":"1ba1243b-d8bd-47d1-835e-2f868e5d4e27","subtype":"command","commandType":"auto","position":4.75,"command":"# diceRoll takes the number of dice as a parameter and then uses the \n# Python uniform random number generator to roll the dice\n# the result is the total of value of the dice roll\ndef diceRoll(numOfDice):\n  total = 0\n  for i in xrange(0, numOfDice):\n    total = total + ceil(uniform(0,6))\n  return total","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"plotOptions":null},"errorSummary":null,"error":null,"startTime":1.440449739214E12,"submitTime":1.440449739163E12,"finishTime":1.440449739259E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"46efc7ac-66de-4dc5-bcf0-0493f92ead11"},{"version":"CommandV1","origId":3937,"guid":"1342753e-8929-4d93-8f21-0b600fd17185","subtype":"command","commandType":"auto","position":4.875,"command":"%md ##Step 3: Run the Simulation Across the Spark Cluster\nCreate a dummy array using the Python range function. \"Roll the dice\" using our predefined function and return a tuple with they key as the total of the dice and 1 to count the number of times this roll appeared. Use the reduceByKey function with the built-in add operator to total the count to get the number of rolls per rollvaluue.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","iPythonMetadata":null,"nuid":"94454a6c-5070-404f-8095-87654553fca0"},{"version":"CommandV1","origId":3938,"guid":"ee08698a-f24f-4d2e-8f3b-d91a26eda183","subtype":"command","commandType":"auto","position":5.0,"command":"diceRDD = sc.parallelize(range(0,1000)).map(lambda x: [diceRoll(2),1]).reduceByKey(add)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"plotOptions":null},"errorSummary":null,"error":null,"startTime":1.440449830103E12,"submitTime":1.440449829992E12,"finishTime":1.440449830185E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"e3c15653-e5a9-4649-9300-a315a80c6adc"},{"version":"CommandV1","origId":3939,"guid":"9bc85735-d6bb-4dd2-87f8-4bb710007505","subtype":"command","commandType":"auto","position":6.0,"command":"%md Create a DataFrame with the roll value as the key and the count as the value.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.440449850052E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"97378e13-f898-4f58-9b10-7b671722f4d6"},{"version":"CommandV1","origId":3940,"guid":"e019d5d5-3f89-4e35-8fb4-36c045504568","subtype":"command","commandType":"auto","position":7.0,"command":"diceDF = sqlContext.createDataFrame(diceRDD.map(lambda x: DiceRoll(x[0], x[1])))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"plotOptions":null},"errorSummary":null,"error":null,"startTime":1.440449860753E12,"submitTime":1.440449860704E12,"finishTime":1.440449865902E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"14738418-5a4b-4e45-90b7-c8076e385bc3"},{"version":"CommandV1","origId":3941,"guid":"f15f9955-45bf-412e-b53a-5e9b6fd3b629","subtype":"command","commandType":"auto","position":8.0,"command":"%md Register this DataFrame as a Temp Table\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","iPythonMetadata":null,"nuid":"0ee5bf9b-118e-4cf0-943f-5282f4d12ac2"},{"version":"CommandV1","origId":3942,"guid":"a8fcd308-f978-4673-bdca-5433421c064d","subtype":"command","commandType":"auto","position":9.0,"command":"diceDF.registerTempTable(\"dice_rolls\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"plotOptions":null},"errorSummary":null,"error":null,"startTime":1.440449882319E12,"submitTime":1.440449882261E12,"finishTime":1.44044988245E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"a329f187-bff3-4240-b7b2-3b0e214be617"},{"version":"CommandV1","origId":3943,"guid":"6acf7315-ce40-479c-b664-1257d2836ad3","subtype":"command","commandType":"auto","position":10.0,"command":"%md You can start to see the normal distribution in as little as 1,000 rolls by selecting from the table and sorting by the RollValue.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.440449905334E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"509433f0-6391-4952-93d6-b0a83a1a9745"},{"version":"CommandV1","origId":3944,"guid":"f3431d10-7b7c-45a4-b9a1-f6325301ba03","subtype":"command","commandType":"auto","position":11.0,"command":"%sql select * from dice_rolls order by RollValue\n","commandVersion":0,"state":"finished","results":{"type":"table","data":[[2.0,32.0],[3.0,48.0],[4.0,88.0],[5.0,124.0],[6.0,172.0],[7.0,124.0],[8.0,88.0],[9.0,136.0],[10.0,92.0],[11.0,56.0],[12.0,40.0]],"arguments":{},"schema":[{"type":"double","name":"RollValue"},{"type":"bigint","name":"RollCount"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":false},"errorSummary":null,"error":null,"startTime":1.440449912926E12,"submitTime":1.440449912857E12,"finishTime":1.440449914161E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"1016.9969971179962","height":"232.99699711799622","xColumns":["RollValue"],"yColumns":["RollCount"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"d912582d-3676-457e-9eaf-a098fa0a9885"},{"version":"CommandV1","origId":3945,"guid":"95a33637-714d-479c-bada-3edbc1ced112","subtype":"command","commandType":"auto","position":11.5,"command":"%md But it is more clear after 100,000 rolls that 7 is most common roll value and 2 and 12 are the lowest.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","iPythonMetadata":null,"nuid":"5936e5a6-cac0-4b57-8a36-cfe7c81344ef"},{"version":"CommandV1","origId":3946,"guid":"faaa5e3c-158a-46b9-a5a2-0cb0f95a2231","subtype":"command","commandType":"auto","position":12.0,"command":"diceRDD = sc.parallelize(range(0,100000)).map(lambda x: [diceRoll(2),1]).reduceByKey(add)\ndiceDF = sqlContext.createDataFrame(diceRDD.map(lambda x: DiceRoll(x[0], x[1])))\ndiceDF.registerTempTable(\"dice_rolls\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"plotOptions":null},"errorSummary":null,"error":null,"startTime":1.440450038887E12,"submitTime":1.440450038823E12,"finishTime":1.440450039422E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"b895f535-0bca-4c9f-a09d-81c484edf4c8"},{"version":"CommandV1","origId":3947,"guid":"46011d2e-5772-4f7e-95bd-4d7c47d761db","subtype":"command","commandType":"auto","position":13.0,"command":"%sql select * from dice_rolls order by RollValue","commandVersion":0,"state":"finished","results":{"type":"table","data":[[2.0,2762.0],[3.0,5528.0],[4.0,8489.0],[5.0,10978.0],[6.0,13694.0],[7.0,16551.0],[8.0,13996.0],[9.0,11201.0],[10.0,8723.0],[11.0,5338.0],[12.0,2740.0]],"arguments":{},"schema":[{"type":"double","name":"RollValue"},{"type":"bigint","name":"RollCount"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":false},"errorSummary":null,"error":null,"startTime":1.4404500468E12,"submitTime":1.440450046752E12,"finishTime":1.440450046941E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"1010.9969971179962","height":"343.9969971179962","xColumns":["RollValue"],"yColumns":["RollCount"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"ea2eb7fb-555b-41ec-a33a-b8290cda135a"},{"version":"CommandV1","origId":3948,"guid":"b7b3c590-d1a8-4315-b89f-9aae8e113e77","subtype":"command","commandType":"auto","position":14.0,"command":"%md \n## Step 4: Let's Calculate the Probabilities\nLet's calculate the probabilities -- as you can see the probabilities match watch the gambler's table above says\n","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","iPythonMetadata":null,"nuid":"f22ab339-1db6-434f-a661-5def07cd53f4"},{"version":"CommandV1","origId":3949,"guid":"4fa6b508-4ef1-423b-b193-911184459bfa","subtype":"command","commandType":"auto","position":15.0,"command":"totalDF = diceDF.groupBy().sum('RollCount').withColumnRenamed(\"SUM(RollCount)\", \"Total\")\ndisplay(totalDF.join(diceDF).selectExpr([\"RollValue\", \"(RollCount / Total) as Probability\"]).sort(\"RollValue\"))","commandVersion":0,"state":"finished","results":{"type":"table","data":[[2.0,0.02762],[3.0,0.05528],[4.0,0.08489],[5.0,0.10978],[6.0,0.13694],[7.0,0.16551],[8.0,0.13996],[9.0,0.11201],[10.0,0.08723],[11.0,0.05338],[12.0,0.0274]],"arguments":{},"schema":[{"type":"double","name":"RollValue"},{"type":"double","name":"Probability"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":false},"errorSummary":null,"error":null,"startTime":1.440450137611E12,"submitTime":1.440450137552E12,"finishTime":1.440450147822E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"3322.996997117996","height":"337.9969971179962","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"26d944ba-e03f-4daa-927c-da02979b204e"},{"version":"CommandV1","origId":3950,"guid":"c2b0438e-8350-4d46-8e27-91180d41e67f","subtype":"command","commandType":"auto","position":16.0,"command":"%md \n## Step 5: Alternative Simulation Method\nRather than having a large RDD (100,000 interations) that is partitioned automatically by Spark you can also kick off one process per node and have that process iterate within the process itself. ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","iPythonMetadata":null,"nuid":"cfda2921-a6ab-4e72-bf52-33e7457cef44"},{"version":"CommandV1","origId":3951,"guid":"b113ec90-1779-40a8-b303-8118137dc6ca","subtype":"command","commandType":"auto","position":17.0,"command":"# This function takes the number of dice rolled and the number of trials and returns \ndef manyDiceRolls(numOfDice, numofTrials):\n  trials = {}\n  # we need to initialize each key in the dictionary with 0\n  for i in xrange(numOfDice, (numOfDice*6)+1):\n    trials[i] = 0\n  # Inside the function we will execute a number of trials\n  for i in xrange(0, numofTrials):\n    trialRollResult = diceRoll(numOfDice)\n    trials[int(trialRollResult)] = trials[int(trialRollResult)] + 1\n  return trials","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"plotOptions":null},"errorSummary":null,"error":null,"startTime":1.440450208321E12,"submitTime":1.440450208262E12,"finishTime":1.440450208376E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"02c7cc16-0483-417b-81e0-d9d9bac3f283"},{"version":"CommandV1","origId":3952,"guid":"d6b3edb5-d812-4729-a135-8c7dcc31e792","subtype":"command","commandType":"auto","position":18.0,"command":"# Example of our Python function\nmanyDiceRolls(2, 1000)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">12</span><span class=\"ansired\">]: </span>\n{2: 35,\n 3: 57,\n 4: 91,\n 5: 124,\n 6: 127,\n 7: 162,\n 8: 137,\n 9: 97,\n 10: 98,\n 11: 49,\n 12: 23}\n</div>","arguments":{},"plotOptions":null},"errorSummary":null,"error":null,"startTime":1.440450225506E12,"submitTime":1.440450225441E12,"finishTime":1.440450225552E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"95678300-d38e-4f9e-9326-3fc46c67fcc1"},{"version":"CommandV1","origId":3953,"guid":"e4229960-33d1-41d1-8f5a-1cc711647b08","subtype":"command","commandType":"auto","position":19.0,"command":"%md Now we use Spark and run this function once per executor and get the same result.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","iPythonMetadata":null,"nuid":"5a691cde-5507-404f-bf31-279d6d70d7d3"},{"version":"CommandV1","origId":3954,"guid":"a206ca4d-3bcd-4f6f-9b44-a6f0147ad94d","subtype":"command","commandType":"auto","position":20.0,"command":"diceRDD = sc.parallelize(range(0,2)).map(lambda x: manyDiceRolls(2,25000)).flatMap(lambda x: x.items()).reduceByKey(add)\ndiceDF = sqlContext.createDataFrame(diceRDD.map(lambda x: DiceRoll(x[0], x[1])))\ndiceDF.registerTempTable(\"dice_rolls\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"plotOptions":null},"errorSummary":null,"error":null,"startTime":1.440450256872E12,"submitTime":1.44045025681E12,"finishTime":1.440450257508E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"cf65aced-a98f-44ef-ba7b-8472c17da209"},{"version":"CommandV1","origId":3955,"guid":"93579174-7990-4c75-8bc8-4ffb1b7fb625","subtype":"command","commandType":"auto","position":21.0,"command":"%sql select * from dice_rolls order by RollValue","commandVersion":0,"state":"finished","results":{"type":"table","data":[[2.0,1392.0],[3.0,2704.0],[4.0,4420.0],[5.0,5370.0],[6.0,6746.0],[7.0,8358.0],[8.0,6880.0],[9.0,5694.0],[10.0,4352.0],[11.0,2712.0],[12.0,1372.0]],"arguments":{},"schema":[{"type":"bigint","name":"RollValue"},{"type":"bigint","name":"RollCount"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":false},"errorSummary":null,"error":null,"startTime":1.440450268806E12,"submitTime":1.440450268729E12,"finishTime":1.440450268929E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"barChart","width":"660","height":"auto","xColumns":["RollValue"],"yColumns":["RollCount"],"pivotColumns":[],"pivotAggregation":"sum","customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rlgarris@databricks.com","iPythonMetadata":null,"nuid":"11830b31-7cd5-4cee-8088-b69f0ed863f9"}],"guid":"5e8da181-998c-499a-bef7-5f560029db0c","globalVars":{},"iPythonMetadata":null};</script>
<script
 src="https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/js/notebook-main.js"
 onerror="window.mainJsLoadError = true;"></script>
<script>var tableOfContentsCell = {"version":"CommandV1","origId":-1,"guid":"0e5a1f41-1503-4284-93dc-41d6dd9ecf13","subtype":"command","commandType":"auto","position":0.0,"command":"%md [&lsaquo; Back to Table of Contents](../index.html)","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"plotOptions":null},"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","iPythonMetadata":null};</script>
</head>
<body>
  <script>
if (window.mainJsLoadError) {
  var u = 'https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/js/notebook-main.js';
  var b = document.getElementsByTagName('body')[0];
  var c = document.createElement('div');
  c.innerHTML = ('<h1>Network Error</h1>' +
    '<p><b>Please check your network connection and try again.</b></p>' +
    '<p>Could not load a required resource: ' + u + '</p>');
  c.style.margin = '30px';
  c.style.padding = '20px 50px';
  c.style.backgroundColor = '#f5f5f5';
  c.style.borderRadius = '5px';
  b.appendChild(c);
}
</script>
</body>
</html>