<!DOCTYPE html>
<html>
<head>
  <meta name="databricks-html-version" content="1">
<title>Spark Streaming / Streaming Producers / Kinesis Word Producer - Databricks</title>

<meta charset="utf-8">
<meta name="google" content="notranslate">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Type" content="text/html; charset=UTF8">
<link rel="stylesheet"
  href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700">

<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/lib/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/lib/jquery-ui-bundle/jquery-ui.min.css">
<link rel="stylesheet" type="text/css" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/css/main.css">
<link rel="stylesheet" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/css/print.css" media="print">
<link rel="icon" type="image/png" href="https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/img/favicon.ico"/>
<script>window.settings = {"sparkDocsSearchGoogleCx":"004588677886978090460:_rj0wilqwdm","dbcForumURL":"http://forums.databricks.com/","dbfsS3Host":"https://databricks-prod-storage-oregon.s3.amazonaws.com","enableThirdPartyApplicationsUI":false,"enableClusterAcls":true,"notebookRevisionVisibilityHorizon":0,"enableTableHandler":true,"isAdmin":false,"enablePresentationTimerConfig":true,"enableFullTextSearch":true,"enableElasticSparkUI":true,"clusters":false,"hideOffHeapCache":false,"applications":false,"useStaticGuide":false,"fileStoreBase":"FileStore","configurableSparkOptionsSpec":[{"keyPattern":"spark\\.kryo(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.kryo.*","valuePatternDisplay":"*","description":"Configuration options for Kryo serialization"},{"keyPattern":"spark\\.io\\.compression\\.codec","valuePattern":"(lzf|snappy|org\\.apache\\.spark\\.io\\.LZFCompressionCodec|org\\.apache\\.spark\\.io\\.SnappyCompressionCodec)","keyPatternDisplay":"spark.io.compression.codec","valuePatternDisplay":"snappy|lzf","description":"The codec used to compress internal data such as RDD partitions, broadcast variables and shuffle outputs."},{"keyPattern":"spark\\.serializer","valuePattern":"(org\\.apache\\.spark\\.serializer\\.JavaSerializer|org\\.apache\\.spark\\.serializer\\.KryoSerializer)","keyPatternDisplay":"spark.serializer","valuePatternDisplay":"org.apache.spark.serializer.JavaSerializer|org.apache.spark.serializer.KryoSerializer","description":"Class to use for serializing objects that will be sent over the network or need to be cached in serialized form."},{"keyPattern":"spark\\.rdd\\.compress","valuePattern":"(true|false)","keyPatternDisplay":"spark.rdd.compress","valuePatternDisplay":"true|false","description":"Whether to compress serialized RDD partitions (e.g. for StorageLevel.MEMORY_ONLY_SER). Can save substantial space at the cost of some extra CPU time."},{"keyPattern":"spark\\.speculation","valuePattern":"(true|false)","keyPatternDisplay":"spark.speculation","valuePatternDisplay":"true|false","description":"Whether to use speculation (recommended off for streaming)"},{"keyPattern":"spark\\.es(\\.[^\\.]+)+","valuePattern":".*","keyPatternDisplay":"spark.es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"es(\\.([^\\.]+))+","valuePattern":".*","keyPatternDisplay":"es.*","valuePatternDisplay":"*","description":"Configuration options for ElasticSearch"},{"keyPattern":"spark\\.(storage|shuffle)\\.memoryFraction","valuePattern":"0?\\.0*([1-9])([0-9])*","keyPatternDisplay":"spark.(storage|shuffle).memoryFraction","valuePatternDisplay":"(0.0,1.0)","description":"Fraction of Java heap to use for Spark's shuffle or storage"},{"keyPattern":"spark\\.streaming\\.backpressure\\.enabled","valuePattern":"(true|false)","keyPatternDisplay":"spark.streaming.backpressure.enabled","valuePatternDisplay":"true|false","description":"Enables or disables Spark Streaming's internal backpressure mechanism (since 1.5). This enables the Spark Streaming to control the receiving rate based on the current batch scheduling delays and processing times so that the system receives only as fast as the system can process. Internally, this dynamically sets the maximum receiving rate of receivers. This rate is upper bounded by the values `spark.streaming.receiver.maxRate` and `spark.streaming.kafka.maxRatePerPartition` if they are set."},{"keyPattern":"spark\\.streaming\\.receiver\\.maxRate","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.receiver.maxRate","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which each receiver will receive data. Effectively, each stream will consume at most this number of records per second. Setting this configuration to 0 or a negative number will put no limit on the rate. See the deployment guide in the Spark Streaming programing guide for mode details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRatePerPartition","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRatePerPartition","valuePatternDisplay":"numeric","description":"Maximum rate (number of records per second) at which data will be read from each Kafka partition when using the Kafka direct stream API introduced in Spark 1.3. See the Kafka Integration guide for more details."},{"keyPattern":"spark\\.streaming\\.kafka\\.maxRetries","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.kafka.maxRetries","valuePatternDisplay":"numeric","description":"Maximum number of consecutive retries the driver will make in order to find the latest offsets on the leader of each partition (a default value of 1 means that the driver will make a maximum of 2 attempts). Only applies to the Kafka direct stream API introduced in Spark 1.3."},{"keyPattern":"spark\\.streaming\\.ui\\.retainedBatches","valuePattern":"^([0-9]{1,})$","keyPatternDisplay":"spark.streaming.ui.retainedBatches","valuePatternDisplay":"numeric","description":"How many batches the Spark Streaming UI and status APIs remember before garbage collecting."}],"enableReactNotebookComments":true,"enableResetPassword":true,"sparkVersions":[{"key":"1.3.x","displayName":"Spark 1.3.0","packageLabel":"spark-1.3-jenkins-ip-10-2-0-138-U094163cf51-S47b89c350f-2015-12-03-00:16:18.916275","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.4.x","displayName":"Spark 1.4.1","packageLabel":"spark-1.4-jenkins-ip-10-2-0-138-U094163cf51-S2f95f6c227-2015-12-03-00:16:18.916275","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.5.x","displayName":"Spark 1.5.2","packageLabel":"spark-1.5-jenkins-ip-10-2-0-138-U094163cf51-S336f76a5be-2015-12-03-00:16:18.916275","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"1.6.x","displayName":"Spark 1.6 Branch Preview","packageLabel":"spark-1.6-jenkins-ip-10-2-0-138-U094163cf51-S3436f2ea50-2015-12-03-00:16:18.916275","upgradable":true,"deprecated":false,"customerVisible":true},{"key":"master","displayName":"Spark master (dev)","packageLabel":"","upgradable":true,"deprecated":false,"customerVisible":false}],"enableRestrictedClusterCreation":false,"enableFeedback":false,"defaultNumWorkers":8,"serverContinuationTimeoutMillis":10000,"driverStderrFilePrefix":"stderr","driverStdoutFilePrefix":"stdout","enableSparkDocsSearch":true,"sparkHistoryServerEnabled":true,"sanitizeMarkdownHtml":true,"enableIPythonImportExport":true,"enableNotebookHistoryDiffing":true,"branch":"2.8.1","local":false,"displayDefaultContainerMemoryGB":6,"deploymentMode":"production","useSpotForWorkers":false,"enableStaticNotebooks":true,"dbcGuideURL":"#workspace/databricks_guide/00 Welcome to Databricks","enableClusterAclsConfig":false,"orgId":0,"enableNotebookGitVersioning":true,"files":"files/","enableDriverLogsUI":true,"disableLegacyDashboards":false,"enableWorkspaceAclsConfig":true,"dropzoneMaxFileSize":4096,"enableNewDashboardViews":false,"driverLog4jFilePrefix":"log4j","enableMavenLibraries":true,"defaultSparkVersion":{"key":"1.5.x","displayName":"Spark 1.5.2","packageLabel":"spark-1.5-jenkins-ip-10-2-0-138-U094163cf51-S336f76a5be-2015-12-03-00:16:18.916275","upgradable":true,"deprecated":false,"customerVisible":true},"clusterPublisherRootId":5,"enableLatestJobRunResultPermalink":true,"enableSparkConfUI":true,"enableJdbcImport":true,"logfiles":"logfiles/","enableClusterDeltaUpdates":true,"csrfToken":"d3dde7ae-fd45-4989-86b8-e91415a5ebcf","useFixedStaticNotebookVersionForDevelopment":false,"enableBasicReactDialogBoxes":true,"requireEmailUserName":true,"enableDashboardViews":false,"dbcFeedbackURL":"http://feedback.databricks.com/forums/263785-product-feedback","enableWorkspaceAclService":true,"enableWorkspaceAcls":true,"gitHash":"094163cf51fcd4717c3ea96799d1008723ae8985","userFullname":"Suresh Jayaram","enableImportFromUrl":true,"enableMiniClusters":false,"enableWebSocketDeltaUpdates":true,"enableDebugUI":false,"showHiddenSparkVersions":false,"allowNonAdminUsers":true,"userId":100017,"dbcSupportURL":"","staticNotebookResourceUrl":"https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/","enableSparkPackages":true,"enableNotebookHistoryUI":true,"enableFolderHtmlExport":true,"enableSparkVersionsUI":true,"databricksGuideStaticUrl":"","notebookLoadingBackground":"#fff","enableNewJobRunDetailsPage":true,"enableDashboardExport":true,"user":"surjayaram@paypal.com","enableServerAutoComplete":true,"enableStaticHtmlImport":true,"defaultMemoryPerContainerMB":6000,"enablePresenceUI":true,"tablesPublisherRootId":7,"accounts":false,"enableNewProgressReportUI":true,"defaultCoresPerContainer":4};</script>
<script>var __DATABRICKS_NOTEBOOK_MODEL = {"version":"NotebookV1","origId":307,"name":"Spark Streaming / Streaming Producers / Kinesis Word Producer","language":"scala","commands":[{"version":"CommandV1","origId":308,"guid":"21ada771-f6dd-4e6c-b9e3-fd0dd73a855f","subtype":"command","commandType":"auto","position":1.0,"command":"%md # **Kinesis Word Count - Producer**\n\nUse this to generate data for running [Kinesis Word Count](../../08 Spark Streaming/04 Kinesis Word Count - Scala.html)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"startTime":0.0,"submitTime":1.434006628956E12,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":null,"diffDeletes":null,"globalVars":{},"latestUser":"td","iPythonMetadata":null,"nuid":"3a4b6445-4c79-4566-a307-f7fe4c27ce30"},{"version":"CommandV1","origId":309,"guid":"b8aded68-c5c6-45f2-bf57-7843595a2c2e","subtype":"command","commandType":"auto","position":2.0,"command":"// === Configurations for Kinesis streams ===\nval awsAccessKeyId = \"YOUR_ACCESS_KEY\"\nval awsSecretKey = \"YOUR_SECRET_KEY\"\nval kinesisStreamName = \"YOUR-TEST-STREAM\"\nval kinesisEndpointUrl = \"YOUR-ENDPOINT\" // e.g. https://kinesis.us-west-2.amazonaws.com\"\n\n// === Configurations of amount of data to produce ===\nval recordsPerSecond = 100\nval wordsPerRecord = 10\nval numSecondsToSend = 10\n","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">awsAccessKeyId: String = YOUR_ACCESS_KEY\nawsSecretKey: String = YOUR_SECRET_KEY\nkinesisStreamName: String = YOUR-TEST-STREAM\nkinesisEndpointUrl: String = YOUR-ENDPOINT\nrecordsPerSecond: Int = 100\nwordsPerRecord: Int = 10\nnumSecondsToSend: Int = 10\n</div>","arguments":{},"plotOptions":null},"errorSummary":null,"error":null,"startTime":1.434064791621E12,"submitTime":1.434064791286E12,"finishTime":1.434064798354E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":null,"diffDeletes":null,"globalVars":{},"latestUser":"vida","iPythonMetadata":null,"nuid":"441eccfc-b444-4520-8ddc-b14af0a3228e"},{"version":"CommandV1","origId":310,"guid":"b80ca026-61b1-43ac-a568-e541908bcf08","subtype":"command","commandType":"auto","position":2.5,"command":"import com.amazonaws.services.kinesis.model.PutRecordRequest\nimport com.amazonaws.services.kinesis.AmazonKinesisClient\nimport com.amazonaws.auth.{DefaultAWSCredentialsProviderChain, BasicAWSCredentials}\nimport java.nio.ByteBuffer\nimport scala.util.Random\n\n// Verify that the Kinesis settings have been set\nrequire(!awsAccessKeyId.contains(\"YOUR\"), \"AWS Access Key has not been set\")\nrequire(!awsSecretKey.contains(\"YOUR\"), \"AWS Access Secret Key has not been set\")\nrequire(!kinesisStreamName.contains(\"YOUR\"), \"Kinesis stream has not been set\")\nrequire(!kinesisEndpointUrl.contains(\"YOUR\"), \"Kinesis endpoint URL has not been set\")\n","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">import com.amazonaws.services.kinesis.model.PutRecordRequest\nimport com.amazonaws.services.kinesis.AmazonKinesisClient\nimport com.amazonaws.auth.{DefaultAWSCredentialsProviderChain, BasicAWSCredentials}\nimport java.nio.ByteBuffer\nimport scala.util.Random\n</div>","arguments":{},"plotOptions":null},"errorSummary":null,"error":null,"startTime":1.434004982383E12,"submitTime":1.434004981231E12,"finishTime":1.434004982779E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":null,"diffDeletes":null,"globalVars":{},"latestUser":"td","iPythonMetadata":null,"nuid":"8406f9db-381f-4568-a7e5-006d03fcfb3e"},{"version":"CommandV1","origId":311,"guid":"816f9ed8-035e-4e84-ab64-2761775ead94","subtype":"command","commandType":"auto","position":3.0,"command":"val randomWords = List(\"spark\", \"you\", \"are\", \"my\", \"father\")\nval totals = scala.collection.mutable.Map[String, Int]()\n\n// Create the low-level Kinesis Client from the AWS Java SDK.\nval kinesisClient = new AmazonKinesisClient(new BasicAWSCredentials(awsAccessKeyId, awsSecretKey))\nkinesisClient.setEndpoint(kinesisEndpointUrl)\n\nprintln(s\"Putting records onto stream $kinesisStreamName and endpoint $kinesisEndpointUrl at a rate of\" +\n  s\" $recordsPerSecond records per second with $wordsPerRecord words per record for $numSecondsToSend seconds\")\n\n// Function to generate data\ndef generateData() = (1 to wordsPerRecord).map { x =>\n  val randomWord = randomWords(Random.nextInt(randomWords.size))\n  totals(randomWord) = totals.getOrElse(randomWord, 0) + 1\n  randomWord\n}.mkString(\" \")\n\n// Generate and send the data\nfor (round <- 1 to numSecondsToSend) {\n  for (recordNum <- 1 to recordsPerSecond) {\n    val data = generateData()\n    val partitionKey = s\"partitionKey-$recordNum\"\n    val putRecordRequest = new PutRecordRequest().withStreamName(kinesisStreamName)\n        .withPartitionKey(partitionKey)\n        .withData(ByteBuffer.wrap(data.getBytes()))\n    kinesisClient.putRecord(putRecordRequest)\n  }\n  Thread.sleep(1000) // Sleep for a second\n  println(s\"Sent $recordsPerSecond records with $wordsPerRecord words each\")\n}\n\nprintln(\"\\nTotal number of records sent\")\ntotals.toSeq.sortBy(_._1).mkString(\"\\n\")\n","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Putting records onto stream TD-test-stream and endpoint https://kinesis.us-west-2.amazonaws.com at a rate of 100 records per second with 10 words per record for 10 seconds\nSent 100 records with 10 words each\nSent 100 records with 10 words each\nSent 100 records with 10 words each\nSent 100 records with 10 words each\nSent 100 records with 10 words each\nSent 100 records with 10 words each\nSent 100 records with 10 words each\nSent 100 records with 10 words each\nSent 100 records with 10 words each\nSent 100 records with 10 words each\n\nTotal number of records sent\nrandomWords: List[String] = List(spark, you, are, my, father)\ntotals: scala.collection.mutable.Map[String,Int] = Map(father -&gt; 1966, spark -&gt; 1971, you -&gt; 1993, my -&gt; 2014, are -&gt; 2056)\nkinesisClient: com.amazonaws.services.kinesis.AmazonKinesisClient = com.amazonaws.services.kinesis.AmazonKinesisClient@5b2394c9\ngenerateData: ()String\nres1: String = \n(are,2056)\n(father,1966)\n(my,2014)\n(spark,1971)\n(you,1993)\n</div>","arguments":{},"plotOptions":null},"errorSummary":null,"error":"<div class=\"ansiout\">java.lang.IllegalArgumentException: requirement failed: AWS Access Key has not been set\n\tat scala.Predef$.require(Predef.scala:233)</div>","startTime":1.434004982785E12,"submitTime":1.434004981263E12,"finishTime":1.434005026714E12,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":null,"diffDeletes":null,"globalVars":{},"latestUser":"td","iPythonMetadata":null,"nuid":"5a8834eb-e808-476b-8f7d-0934edd61283"}],"guid":"44ad09ca-a46e-46ba-859a-d8afc9bd9a41","globalVars":{},"iPythonMetadata":null};</script>
<script
 src="https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/js/notebook-main.js"
 onerror="window.mainJsLoadError = true;"></script>
<script>var tableOfContentsCell = {"version":"CommandV1","origId":-1,"guid":"77f7fecd-d945-48d4-b6b6-48c0233f1dd7","subtype":"command","commandType":"auto","position":0.0,"command":"%md [&lsaquo; Back to Table of Contents](../../index.html)","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"plotOptions":null},"errorSummary":null,"error":null,"startTime":0.0,"submitTime":0.0,"finishTime":0.0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","iPythonMetadata":null};</script>
</head>
<body>
  <script>
if (window.mainJsLoadError) {
  var u = 'https://databricks-prod-cloudfront.cloud.databricks.com/static/201512022229240000-094163cf51fcd4717c3ea96799d1008723ae8985/js/notebook-main.js';
  var b = document.getElementsByTagName('body')[0];
  var c = document.createElement('div');
  c.innerHTML = ('<h1>Network Error</h1>' +
    '<p><b>Please check your network connection and try again.</b></p>' +
    '<p>Could not load a required resource: ' + u + '</p>');
  c.style.margin = '30px';
  c.style.padding = '20px 50px';
  c.style.backgroundColor = '#f5f5f5';
  c.style.borderRadius = '5px';
  b.appendChild(c);
}
</script>
</body>
</html>